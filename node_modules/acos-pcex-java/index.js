/* global module, require, __dirname */
/* jshint globalstrict: true */
'use strict';
var http = require('http');
var https = require('https');
var url = require('url');
var htmlencode = require('htmlencode').htmlEncode;
var nj = require('nunjucks');
var baseDir = __dirname;
var PCEXJava = function() {};


PCEXJava.initialize = function(req, params, handlers, cb) {
  initializeAsync(req, params, cb);
};

PCEXJava.addToBody = function(req, params) {
	return '<input type=hidden name=pcex_name value="/acos/static/pcex-java/data/JAVA_' + htmlencode(params.name) + '.json">';
}

function initializeAsync (req, params, cb) {
    // Helper functions
    var addData = function(data) {
        params.headContent += data;
    };

    var handleResult = function(result) {
        var body = '';
        if (result.statusCode == 200) {

            result.setEncoding('utf8');
            result.on('data', function(chunk) {
				chunk = chunk.replace("<!DOCTYPE html>", "");
				chunk = chunk.replace("<html lang=\"en\">", "");
				chunk = chunk.replace("<head>", "");
				chunk = chunk.replace("</head>", "");
				

                body += chunk;
            });
            result.on('end', function() {
                addData(body);
                cb();
            });
            
        } else {
            params.error = 'Missing required parameter';
            cb();
        }
    };
	
	params.bodyContent += PCEXJava.addToBody(req,params);
	
	cb();

	//http.get("http://pawscomp2.sis.pitt.edu/pcex/pcex_v2/index.html?lang=JAVA&set=arrays.j_array_min_max&svc=masterygrids&grp=ADL&usr=demo&sid=TEST&cid=351&v=201803162257", function(result) { 
		//handleResult(result);
	//}).on('error', function(e) {
		//params.error = 'Communication error';
		//cb();
	//});

}

PCEXJava.register = function(handlers) {
    handlers.contentPackages['pcex-java'] = PCEXJava;
    handlers.contentTypes.pcex.installedContentPackages.push(PCEXJava);
};

PCEXJava.namespace = 'pcex-java';
PCEXJava.contentTypeNamespace = 'pcex';
PCEXJava.packageContents = [];
PCEXJava.packageType = 'content';

PCEXJava.meta = {
    'name': 'pcex-java',
    'shortDescription': 'Pcex Java Exercises',
    'description': '',
    'author': 'Kamil',
    'license': 'MIT',
    'version': '0.0.1',
    'url': ''
};

module.exports = PCEXJava;